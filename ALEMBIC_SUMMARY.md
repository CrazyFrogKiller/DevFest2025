# ‚úÖ Alembic Setup - –ó–ê–í–ï–†–®–ï–ù–û

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ú–æ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã ‚úÖ

- **document.py**: Integer ID ‚Üí UUID, —É–±—Ä–∞–Ω—ã –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ
- **chunk.py**: Integer ID ‚Üí UUID, —É–±—Ä–∞–Ω—ã start_char/end_char, JSONB –¥–ª—è metadata

### 2. Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚úÖ

- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø–∞–ø–∫–∞ alembic/
- ‚úÖ –°–æ–∑–¥–∞–Ω env.py —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π pgvector –∏ JSONB
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω alembic.ini —Å script_location
- ‚úÖ –°–æ–∑–¥–∞–Ω script.py.mako —à–∞–±–ª–æ–Ω
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è 001_initial

### 3. –ë–î —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ ‚úÖ

- ‚úÖ –¢–∞–±–ª–∏—Ü—ã documents –∏ chunks —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ pgvector —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (v0.8.1)
- ‚úÖ IVFFLAT –∏–Ω–¥–µ–∫—Å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω
- ‚úÖ Foreign keys —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (cascade delete)
- ‚úÖ JSONB –∏–Ω–¥–µ–∫—Å—ã –≥–æ—Ç–æ–≤—ã

### 4. Services –æ–±–Ω–æ–≤–ª–µ–Ω—ã ‚úÖ

- ‚úÖ IngestionService - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å UUID
- ‚úÖ ChunkingService - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –∫ –Ω–æ–≤–æ–π —Å—Ö–µ–º–µ
- ‚úÖ API endpoints - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è UUID

### 5. –£—Ç–∏–ª–∏—Ç—ã —Å–æ–∑–¥–∞–Ω—ã ‚úÖ

- ‚úÖ migrate.py - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ verify_db.py - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î
- ‚úÖ ALEMBIC_GUIDE.md - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ ALEMBIC_READY.md - –∏—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
- ‚úÖ ALEMBIC_QUICK.md - –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î

```
‚úÖ PostgreSQL Version: 18.1
‚úÖ pgvector Extension: 0.8.1
‚úÖ Tables: 3 (alembic_version, documents, chunks)
‚úÖ Indexes: 5 (all working)
‚úÖ Alembic Version: 001_initial
‚úÖ Foreign Keys: 1 (chunks.document_id)
‚úÖ Documents: 0 (ready for data)
‚úÖ Chunks: 0 (ready for data)
```

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
uv run python verify_db.py

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
uv run alembic revision --autogenerate -m "description"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
uv run alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å
uv run alembic downgrade -1

# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å psycopg
uv run python migrate.py
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **ALEMBIC_QUICK.md** ‚Üê –ù–∞—á–Ω–∏—Ç–µ –æ—Ç—Å—é–¥–∞ (–∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞)
2. **ALEMBIC_GUIDE.md** ‚Üê –ü–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥
3. **ALEMBIC_READY.md** ‚Üê –ü–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å
4. **migrate.py** ‚Üê –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –º–∏–≥—Ä–∞—Ü–∏–∏
5. **verify_db.py** ‚Üê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üîß –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã/—Å–æ–∑–¥–∞–Ω—ã

### –ú–æ–¥–µ–ª–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω—ã)

- `app/models/document.py`
- `app/models/chunk.py`

### Services (–æ–±–Ω–æ–≤–ª–µ–Ω—ã)

- `app/services/ingestion.py`
- `app/services/chunking.py`
- `app/api/documents.py`

### Alembic (—Å–æ–∑–¥–∞–Ω—ã)

- `alembic/env.py` ‚Üê –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `alembic/script.py.mako` ‚Üê –®–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π
- `alembic/versions/001_initial.py` ‚Üê –ù–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- `alembic.ini` ‚Üê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic

### –£—Ç–∏–ª–∏—Ç—ã (—Å–æ–∑–¥–∞–Ω—ã)

- `migrate.py` ‚Üê –ü—Ä—è–º–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- `verify_db.py` ‚Üê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
- `ALEMBIC_GUIDE.md` ‚Üê –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `ALEMBIC_READY.md` ‚Üê –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
- `ALEMBIC_QUICK.md` ‚Üê –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

## üí° –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

### UUID –≤–º–µ—Å—Ç–æ Integer

- –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
- –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

### pgvector –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- –í–µ–∫—Ç–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–æ–º 768 (Gemini embeddings)
- IVFFLAT –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ì–æ—Ç–æ–≤–æ –¥–ª—è ML –º–æ–¥–µ–ª–µ–π

### JSONB –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

- –ì–∏–±–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ó–∞–ø—Ä–æ—Å—ã –ø–æ JSON –≤–æ–∑–º–æ–∂–Ω—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

- alembic_version —Ç–∞–±–ª–∏—Ü–∞
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É**

   ```bash
   uv run python -m uvicorn app.main:app --reload
   ```

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API**

   - POST /api/documents/upload
   - POST /api/queries/ask

3. **–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏**
   - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏
   - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å

## ‚ú® –í—Å–µ –≥–æ—Ç–æ–≤–æ!

–í–∞—à–∞ RAG —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –ë–î –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---

**–î–∞—Ç–∞**: 2025-12-08
**–°—Ç–∞—Ç—É—Å**: ‚úÖ READY
**–í–µ—Ä—Å–∏—è**: 1.0.0
